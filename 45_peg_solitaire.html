<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>45-Hole Peg Solitaire</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            padding: 20px;
        }
        
        h1 {
            color: #333;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(9, 50px);
            grid-template-rows: repeat(9, 50px);
            gap: 5px;
            background-color: #8B4513;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .cell {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
        }
        
        .hole {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #D2B48C;
            border: 2px solid #8B4513;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .peg {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #006400;
            border: 2px solid #004d00;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .empty {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #D2B48C;
            border: 2px dashed #8B4513;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .info {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
        }
        
        .moves {
            font-weight: bold;
            color: #333;
        }
        
        .message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            min-height: 20px;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .instructions {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 400px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            margin-top: 0;
        }
        
        .instructions ul {
            text-align: left;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <h1>45-Hole Peg Solitaire</h1>
    
    <div class="game-container">
        <div class="info">
            <div>Moves: <span id="move-count" class="moves">0</span></div>
            <div>Pegs remaining: <span id="peg-count" class="moves">44</span></div>
            <div id="message" class="message"></div>
        </div>
        
        <div class="board" id="board">
            <!-- Board will be generated by JavaScript -->
        </div>
        
        <div class="controls">
            <button id="reset-btn">Reset Game</button>
            <button id="undo-btn">Undo</button>
        </div>
    </div>
    
    <div class="instructions">
        <h3>How to Play</h3>
        <ul>
            <li>Jump a peg over an adjacent peg into an empty hole</li>
            <li>Remove the jumped peg from the board</li>
            <li>Goal: Leave only one peg on the board</li>
            <li>Click a peg to select it, then click an empty hole to move</li>
        </ul>
    </div>

    <script>
        // Game state
        const gameState = {
            board: [],
            selectedPeg: null,
            moves: 0,
            pegsRemaining: 36,
            messageElement: document.getElementById('message'),
            moveCountElement: document.getElementById('move-count'),
            pegCountElement: document.getElementById('peg-count'),
            moveHistory: [] // For undo functionality
        };
        
        // Initialize the board layout (45 holes)
        // 0 = invalid position, 1 = peg, 2 = empty hole
        function initializeBoard() {
            // Create 9x9 grid for the 45-hole layout
            const boardLayout = [
                [0, 0, 0, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 1, 1, 1, 0, 0, 0],
                [1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 2, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1],
                [0, 0, 0, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 1, 1, 1, 0, 0, 0]
            ];
            
            gameState.board = boardLayout;
            gameState.selectedPeg = null;
            gameState.moves = 0;
            gameState.pegsRemaining = 44;
            
            updateMoveCount();
            updatePegCount();
            clearMessage();
        }
        
        // Render the board
        function renderBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const cellValue = gameState.board[row][col];
                    
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    if (cellValue !== 0) { // Valid position
                        const hole = document.createElement('div');
                        hole.className = 'hole';
                        
                        if (cellValue === 1) { // Peg
                            const peg = document.createElement('div');
                            peg.className = 'peg';
                            if (gameState.selectedPeg && 
                                gameState.selectedPeg.row === row && 
                                gameState.selectedPeg.col === col) {
                                peg.style.borderColor = '#ff0000';
                                peg.style.borderWidth = '3px';
                            }
                            hole.appendChild(peg);
                        } else if (cellValue === 2) { // Empty hole
                            const empty = document.createElement('div');
                            empty.className = 'empty';
                            hole.appendChild(empty);
                        }
                        
                        hole.addEventListener('click', () => handleCellClick(row, col));
                        cell.appendChild(hole);
                    }
                    
                    boardElement.appendChild(cell);
                }
            }
        }
        
        // Handle cell click
        function handleCellClick(row, col) {
            const cellValue = gameState.board[row][col];
            
            // If clicking on a peg
            if (cellValue === 1) {
                // If no peg is selected, select this peg
                if (!gameState.selectedPeg) {
                    gameState.selectedPeg = { row, col };
                    renderBoard();
                    showMessage("Peg selected. Now click on an empty hole to jump.");
                } 
                // If clicking on the same peg, deselect it
                else if (gameState.selectedPeg.row === row && gameState.selectedPeg.col === col) {
                    gameState.selectedPeg = null;
                    renderBoard();
                    clearMessage();
                } 
                // If clicking on a different peg, select the new peg
                else {
                    gameState.selectedPeg = { row, col };
                    renderBoard();
                    showMessage("Peg selected. Now click on an empty hole to jump.");
                }
            } 
            // If clicking on an empty hole
            else if (cellValue === 2) {
                // If a peg is selected, try to move
                if (gameState.selectedPeg) {
                    if (isValidMove(gameState.selectedPeg.row, gameState.selectedPeg.col, row, col)) {
                        makeMove(gameState.selectedPeg.row, gameState.selectedPeg.col, row, col);
                        gameState.selectedPeg = null;
                        renderBoard();
                        checkGameEnd();
                    } else {
                        showMessage("Invalid move! Pegs can only jump orthogonally over adjacent pegs.", "error");
                    }
                } else {
                    showMessage("Select a peg first, then click on an empty hole to jump.", "error");
                }
            }
        }
        
        // Check if a move is valid
        function isValidMove(fromRow, fromCol, toRow, toCol) {
            // Must be orthogonal move (same row or same column)
            if (fromRow !== toRow && fromCol !== toCol) return false;
            
            // Must be exactly two spaces away
            const rowDiff = Math.abs(toRow - fromRow);
            const colDiff = Math.abs(toCol - fromCol);
            
            if (!((rowDiff === 2 && colDiff === 0) || (rowDiff === 0 && colDiff === 2))) {
                return false;
            }
            
            // Middle position must have a peg
            const midRow = (fromRow + toRow) / 2;
            const midCol = (fromCol + toCol) / 2;
            
            return gameState.board[midRow][midCol] === 1;
        }
        
        // Make a move
        function makeMove(fromRow, fromCol, toRow, toCol) {
            // Save current state for undo
            gameState.moveHistory.push({
                from: { row: fromRow, col: fromCol },
                to: { row: toRow, col: toCol },
                mid: { row: (fromRow + toRow) / 2, col: (fromCol + toCol) / 2 },
                board: JSON.parse(JSON.stringify(gameState.board))
            });
            
            // Move peg to new position
            gameState.board[toRow][toCol] = 1;
            
            // Remove peg from old position
            gameState.board[fromRow][fromCol] = 2;
            
            // Remove jumped peg
            const midRow = (fromRow + toRow) / 2;
            const midCol = (fromCol + toCol) / 2;
            gameState.board[midRow][midCol] = 2;
            
            // Update game state
            gameState.moves++;
            gameState.pegsRemaining--;
            
            updateMoveCount();
            updatePegCount();
        }
        
        // Check if the game has ended
        function checkGameEnd() {
            // Check if there are any valid moves left
            let hasValidMoves = false;
            
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    // If this is a peg
                    if (gameState.board[row][col] === 1) {
                        // Check in all four directions
                        if (isValidMove(row, col, row - 2, col) || 
                            isValidMove(row, col, row + 2, col) || 
                            isValidMove(row, col, row, col - 2) || 
                            isValidMove(row, col, row, col + 2)) {
                            hasValidMoves = true;
                            break;
                        }
                    }
                }
                if (hasValidMoves) break;
            }
            
            // If no valid moves, game ends
            if (!hasValidMoves) {
                if (gameState.pegsRemaining === 1) {
                    showMessage("Congratulations! You solved the puzzle!", "success");
                } else if (gameState.pegsRemaining === 1) {
                    showMessage("Good job! You have one peg left, but it's not in the center.", "success");
                } else {
                    showMessage(`Game over! You have ${gameState.pegsRemaining} pegs left. Try again!`, "error");
                }
            }
        }
        
        // Undo the last move
        function undoMove() {
            if (gameState.moveHistory.length === 0) {
                showMessage("No moves to undo!", "error");
                return;
            }
            
            // Get the last move
            const lastMove = gameState.moveHistory.pop();
            
            // Restore the board state
            gameState.board = lastMove.board;
            
            // Update game state
            gameState.moves--;
            gameState.pegsRemaining++;
            
            updateMoveCount();
            updatePegCount();
            renderBoard();
            clearMessage();
        }
        
        // Update move counter display
        function updateMoveCount() {
            gameState.moveCountElement.textContent = gameState.moves;
        }
        
        // Update peg counter display
        function updatePegCount() {
            gameState.pegCountElement.textContent = gameState.pegsRemaining;
        }
        
        // Show message
        function showMessage(text, type = "") {
            gameState.messageElement.textContent = text;
            gameState.messageElement.className = "message";
            if (type) {
                gameState.messageElement.classList.add(type);
            }
        }
        
        // Clear message
        function clearMessage() {
            gameState.messageElement.textContent = "";
            gameState.messageElement.className = "message";
        }
        
        // Reset the game
        function resetGame() {
            initializeBoard();
            renderBoard();
            showMessage("Game reset! Select a peg to start playing.");
        }
        
        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeBoard();
            renderBoard();
            
            // Set up event listeners
            document.getElementById('reset-btn').addEventListener('click', resetGame);
            document.getElementById('undo-btn').addEventListener('click', undoMove);
            
            showMessage("Welcome to Peg Solitaire! Select a peg to start playing.");
        });
    </script>
</body>
</html>